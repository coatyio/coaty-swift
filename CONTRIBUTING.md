# Contributing to CoatySwift

Contributions to the CoatySwift framework are welcome and appreciated.
If you wish to contribute please follow the guidelines described in this document.

## Table of Contents

* [Workflow](#workflow)
* [Git Commit Style](#git-commit-style)
* [License and Copyright Notice](#license-and-copyright-notice)
* [Coding Style](#coding-style)
* [Build CoatySwift](#build-coatyswift)
* [Generate CoatySwift documentation](#generate-coatyswift-documentation)
* [Test CoatySwift](#test-coatyswift)
* [Release CoatySwift](#release-coatyswift)

## Workflow

Contributions should be incorporated into the repository using pull requests on
a separate branch. We use the [GitHub Pull Request Workflow](https://guides.github.com/introduction/flow/).
The mentioned link is the recommended documentation to read and understand this workflow.

## Git Commit Style

We are using the [Conventional Commits Style](https://conventionalcommits.org/)
for our commit messages:

```
<type>[optional scope]: <description>

[optional body]

[optional footer]
```

Conventional Commits Style helps structuring Git commit messages in a way that
allows automatic generation of changelogs. These conventions can form the basis
for automatic version bumping and CHANGELOG management when cutting a new
release.

> **Note**: The current build process does not support automatic versioning and changelog
> management. However, it is intended to add this feature in a future release.

## License and Copyright Notice

CoatySwift source code is licensed under the [MIT License](https://opensource.org/licenses/MIT).
Attach a license and copyright notice to the top of each created source files as follows:

```swift
// Copyright (c) <year> <contributor>. Licensed under the MIT License.
```

`<year>` specifies the year of *first* publication and must *not* be changed
when you modify the contents of the file later on. Do *not* add additional
copyright notices or dates when the work is revised at a future time.

Contributions without this header on each new source file won't be accepted.

The meaning of source file covers all files, which allow adding a comment easily
(e.g. `.swift`) and contribute to the core value of the project by adding
originality (e.g. no configuration files).

Documentation and media work (such as icons) should be licensed under
a [Creative Commons Attribution-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-sa/4.0/)
(CC BY-SA 4.0).

## Coding Style

The framework includes a custom [SwiftLint](https://github.com/realm/SwiftLint)
configuration that can also be used in Coaty application projects.

## Build CoatySwift

You need XCode 10.2 or higher. Ensure you have installed **at least** version
`1.8.4` of [CocoaPods](https://cocoapods.org), i.e. running `pod --version`
should yield `1.8.4` or higher.

To build and run the Example application including the CoatySwift framework, run
`pod install` on the CoatySwift `Example` folder and open the new `xcworkspace`
in Xcode.

## Generate CoatySwift documentation

The framework API documentation can automatically be generated by using
[Jazzy](https://github.com/realm/jazzy). From the root directory of the
repository run:

```sh
jazzy
```

Execute the command to generate HTML documentation from the Swift source code
and the included comments. The generated documentation is written to the
`docs/api/` folder and accessible by opening a web browser on the `index.html`
file. The Jazzy configuration is located in the `.jazzy.yaml` file in the
repository root.

## Test CoatySwift

Currently there is no testbench for CoatySwift.

## Release CoatySwift

Before releasing a new CoatySwift version, ensure to test the framework code
against the example in the `Example` Xcode folder of the CoatySwift repo and the
examples in the `swift` sections of the
[coaty-examples](https://github.com/coatyio/coaty-examples) repo on GitHub.

You can also use `pod lib lint` to validate the Pod locally using the files in
the CoatySwift working directory.

In order to release a new CoatySwift version on CocoaPods, you have to follow
these steps:

1. Update the pod version in the `CoatySwift.podspec` file located in the
   repository root. Follow [semantic versioning](https://semver.org/).
2. Build the Example application in the `Example` folder with Xcode.
3. Generate Coaty framework documentation. First, update the `module_version` in
   the `.jazzy.yaml` file to match the version number from step 1.

   ```sh
   jazzy
   ```

4. Manually update `CHANGELOG.md` with release information from the conventional
   commits. Take a look at the Coaty JS
   [CHANGELOG](https://github.com/coatyio/coaty-js/blob/master/CHANGELOG.md) to
   see how the format should look like.
5. Commit with message `chore(release): v[pod version]` and push all your
   changes to the develop branch.
6. Create an annotated `git` tag for the new pod version and push it. Make sure
   that `[pod version]` matches the version number from step 1.

   ```sh
   git tag -a -f -m 'chore(release): v[pod version]' [pod version]
   git push origin --tags
   ```

7. Merge the local develop branch into local master and push master. This
   ensures GitHub Pages automatically regenerates the CoatySwift documentation
   website.
8. You now need to check whether the pod passes verification. Run the following command:

   ```sh
   pod spec lint CoatySwift.podspec
   ```

9. If the previous step was successful, deploy the new Podspec to make it
   publicly available:

   ```sh
   pod trunk push CoatySwift.podspec
   ```

   This step assumes that you have already registered an account on
   [CocoaPods
   Trunk](https://guides.cocoapods.org/making/getting-setup-with-trunk.html) and
   have been added as a library owner for the CoatySwift pod.

---
Copyright (c) 2019 Siemens AG. This work is licensed under a
[Creative Commons Attribution-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-sa/4.0/).
